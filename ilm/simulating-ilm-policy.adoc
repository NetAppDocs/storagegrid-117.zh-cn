---
permalink: ilm/simulating-ilm-policy.html 
sidebar: sidebar 
keywords: simulate ilm policy 
summary: 在激活策略并将其应用于生产数据之前、模拟测试对象上的建议策略。模拟窗口提供了一个独立的环境，可在激活策略并将其应用于生产环境中的数据之前安全地对策略进行测试。 
---
= 模拟 ILM 策略
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
在激活策略并将其应用于生产数据之前、模拟测试对象上的建议策略。模拟窗口提供了一个独立的环境，可在激活策略并将其应用于生产环境中的数据之前安全地对策略进行测试。

.开始之前
* 您将使用登录到网格管理器 link:../admin/web-browser-requirements.html["支持的 Web 浏览器"]。
* 您拥有 link:../admin/admin-group-permissions.html["所需的访问权限"]。
* 您知道要测试的每个对象的S3分段/对象密钥或Swift容器/对象名称。


.关于此任务
仔细选择要测试建议策略的对象。要全面模拟策略，您应至少为每个规则中的每个筛选器测试一个对象。

例如，如果某个策略包含一个规则来匹配存储分段 A 中的对象，另一个规则来匹配存储分段 B 中的对象，则必须从存储分段 A 中至少选择一个对象，并从存储分段 B 中选择一个对象来全面测试该策略。您还必须从另一个存储分段中至少选择一个对象，以测试默认规则。

模拟策略时，应考虑以下注意事项：

* 更改策略后，保存建议的策略。然后，模拟已保存的建议策略的行为。
* 模拟策略时，策略中的 ILM 规则会筛选测试对象，以便您可以查看对每个对象应用了哪个规则。但是，不会创建任何对象副本，也不会放置任何对象。运行模拟不会以任何方式修改数据，规则或策略。
* "模拟建议的策略"窗口将保留您测试的对象，直到您选择*Clear All*或删除图标为止 image:../media/icon-x-to-remove.png["删除图标"] 对于Simulation结果列表中的每个对象。
* Simulation 将返回匹配规则的名称。要确定哪个存储池或纠删编码配置文件有效、请选择规则的名称以转到规则详细信息页面、您可以在该页面中查看保留图和有关规则的其他详细信息。
* 如果启用了S3版本控制、则可以输入要用于模拟的对象版本的版本ID。


.步骤
. link:creating-proposed-ilm-policy.html["创建建议的策略"]。
. 使用 S3 或 Swift 客户端或 link:../tenant/use-s3-console.html["S3 控制台处于实验阶段"]（可在租户管理器中为每个租户提供），载入测试每个规则所需的对象。
. 在ILM策略页面的建议策略选项卡中、选择*模拟*。
. 在*Object*字段中，输入S3 `bucket/object-key` 或Swift `container/object-name` 测试对象。例如： `bucket-01/filename.png`。
. (可选)在“*版本ID*”字段中输入对象的版本ID。
. 选择 * 模拟 * 。
. 在Simulation Results部分中、确认每个对象都使用正确的规则进行匹配。




== 示例 1 ：模拟建议的 ILM 策略时验证规则

此示例介绍了在模拟建议的策略时如何验证规则。

在此示例中，正在针对两个分段中的输入对象模拟 * 示例 ILM 策略 * 。此策略包括三个规则，如下所示：

* 第一条规则 * 两个副本，即 bucket-A* 两年，仅适用于 bucket-a 中的对象
* 第二条规则 * EC 对象 > 1 MB* ，适用场景 all b桶 but filters on objects 大于 1 MB 。
* 第三条规则为 * 两个副本，两个数据中心 * 。它不包含任何筛选器，也不使用非当前参考时间。


模拟策略后、确认每个对象均符合正确的规则。

image::../media/simulate_policy_screen.png[模拟策略结果]

在此示例中：

* `bucket-a/bucket-a object.pdf` 已正确匹配第一个规则、此规则会对中的对象进行筛选 `bucket-a`。
* `bucket-b/test object greater than 1 MB.pdf` 位于中 `bucket-b`、因此与第一条规则不匹配。而是通过第二条规则正确匹配，该规则会对大于 1 MB 的对象进行筛选。
* `bucket-b/test object less than 1 MB.pdf` 与前两个规则中的筛选器不匹配、因此将由默认规则放置、该规则不包含任何筛选器。




== 示例 2 ：模拟建议的 ILM 策略时重新排列规则

此示例显示了在模拟策略时如何重新排列规则以更改结果。

在此示例中，正在模拟 * 演示 * 策略。此策略用于查找具有 series=x-men 用户元数据的对象，它包含以下三个规则：

* 第一个规则* PNGS*用于筛选以结尾的密钥名称 `.png`。
* 第二个规则* X-men*仅适用于租户A和筛选器的对象 `series=x-men` 用户元数据。
* 最后一条规则*two copes two data centres *是默认规则，它匹配与前两条规则不匹配的任何对象。


.步骤
. 添加规则并保存策略后，选择 * 模拟 * 。
. 在 * 对象 * 字段中，输入测试对象的 S3 存储分段 / 对象密钥或 Swift 容器 / 对象名称，然后选择 * 模拟 * 。
+
此时将显示模拟结果、并显示 `Havok.png` 对象已与* PNGS*规则匹配。

+
image::../media/simulate_reorder_rules_pngs_result.png[示例 2 ：模拟建议的 ILM 策略时对规则重新排序]

+
但是、 `Havok.png` 是为了测试*X-men*规则。

. 要解析问题描述 ，请对规则重新排序。
+
.. 选择*完成*以关闭模拟ILM策略窗口。
.. 选择*Actions*>*Edit*以编辑策略。
.. 将 *X-men* 规则拖动到列表顶部。
.. 选择 * 保存 * 。


. 选择 * 模拟 * 。
+
系统会根据更新后的策略重新评估先前测试的对象，并显示新的模拟结果。在此示例中、规则匹配列显示 `Havok.png` 现在、对象将按预期匹配X-men元数据规则。上一个匹配列显示了与上一个模拟中的对象匹配的PNG规则。

+
image::../media/simulate_reorder_rules_correct_result.png[示例 2 ：模拟建议的 ILM 策略时对规则重新排序]

+

NOTE: 如果您停留在"建议的策略"选项卡上、则可以在进行更改后重新模拟策略、而无需重新输入测试对象的名称。





== 示例 3 ：模拟建议的 ILM 策略时更正规则

此示例显示了如何模拟策略，更正策略中的规则以及继续模拟。

在此示例中，正在模拟 * 演示 * 策略。此策略用于查找具有的对象 `series=x-men` 用户元数据。但是、在使用模拟此策略时会出现意外结果 `Beast.jpg` 对象。该对象与默认规则匹配，而不是与 X-men 元数据规则匹配，而是复制两个数据中心。

image::../media/simulate_results_for_object_wrong_metadata.png[示例 3 ：模拟建议的 ILM 策略时更正规则]

如果测试对象与策略中的预期规则不匹配，则必须检查策略中的每个规则并更正任何错误。

.步骤
. 选择*完成*以关闭模拟策略对话框。在“建议的策略”选项卡上，选择“*保留图*”。然后根据需要为每个规则选择*全部展开*或*查看详细信息*。
. 查看规则的租户帐户，参考时间和筛选条件。
+
例如、假设X-men规则的元数据输入为"`x-men01`"、而不是"`x-men.`"

. 要解决此错误、请按如下所示更正此规则：
+
** 如果规则是建议策略的一部分，则可以克隆此规则，也可以从策略中删除此规则，然后对其进行编辑。
** 如果规则是活动策略的一部分，则必须克隆此规则。您不能编辑或删除活动策略中的规则。
+
[cols="1a,3a"]
|===
| 选项 | 步骤 


 a| 
克隆规则
 a| 
... 选择 * ILM * > * 规则 * 。
... 选择不正确的规则，然后选择 * 克隆 * 。
... 输入新规则的名称，然后更改不正确的信息并选择*Creation*。
... 选择*ilm*>*policies*>*proproproproproxi*。
... 选择*Actions*>*Edit*。
... 选择*选择规则*，然后选择*继续*接受相同的默认规则。
... 在选择其他规则步骤中，选中新规则的复选框，清除原始规则的复选框，然后选择*Select*。
... 如有必要、可通过将新规则拖动到正确位置来对规则进行重新排序。
... 选择 * 保存 * 。




 a| 
编辑规则
 a| 
... 选择*ilm*>*policies*>*proㄒ ed policy*并删除要编辑的规则。
... 选择 * ILM * > * 规则 * 。
... 选择要编辑的规则，然后选择*Edit*。或者选中规则的复选框，然后选择*Actions*>*Edit*。
... 更改向导每个部分的错误信息，然后选择*Update*。
... 选择*ilm*>*policies*>*proproproproproxi*。
... 选择*Actions*>*Edit*。
... 选择*选择规则*，然后选择*继续*接受相同的默认规则。
... 在“选择其他规则”对话框中，选中已更正规则的复选框，选择*Select*，然后选择*Save*。
... 拖动非默认规则的行以确定评估这些规则的顺序。


|===


. 再次执行模拟。
+
在此示例中、更正后的X-men规则现在与匹配 `Beast.jpg` 基于的对象 `series=x-men` 用户元数据、如预期。

+
image::../media/simulate_results_for_object_corrected_metadata.png[示例 3 ：模拟建议的 ILM 策略时更正规则]


